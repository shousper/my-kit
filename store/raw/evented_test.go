package raw_test

import (
	"testing"

	"my-kit/store/raw"
	"my-kit/store/raw/test"
)

/*
BenchmarkNewEventedStore/Get_1000/16-4         	 5000000	       338 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Set_1000/16-4         	 5000000	       283 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Delete_1000/16-4      	10000000	       225 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Reset_1000/16-4       	 5000000	       283 ns/op	      48 B/op	       1 allocs/op
BenchmarkNewEventedStore/Iterate_1000/16-4     	10000000	       161 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Get_1000/1024-4       	 5000000	       240 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Set_1000/1024-4       	10000000	       197 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Delete_1000/1024-4    	10000000	       158 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Reset_1000/1024-4     	10000000	       276 ns/op	      48 B/op	       1 allocs/op
BenchmarkNewEventedStore/Iterate_1000/1024-4   	10000000	       159 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Get_1000/262144-4     	10000000	       236 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Set_1000/262144-4     	10000000	       197 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Delete_1000/262144-4  	10000000	       161 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Reset_1000/262144-4   	10000000	       282 ns/op	      48 B/op	       1 allocs/op
BenchmarkNewEventedStore/Iterate_1000/262144-4 	10000000	       155 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Get_1000000/16-4      	 5000000	       383 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Set_1000000/16-4      	 2000000	       522 ns/op	     100 B/op	       0 allocs/op
BenchmarkNewEventedStore/Delete_1000000/16-4   	10000000	       174 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Reset_1000000/16-4    	10000000	       233 ns/op	      48 B/op	       1 allocs/op
BenchmarkNewEventedStore/Iterate_1000000/16-4  	 5000000	       264 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Get_1000000/1024-4    	 5000000	       386 ns/op	      32 B/op	       1 allocs/op
BenchmarkNewEventedStore/Set_1000000/1024-4    	 3000000	       421 ns/op	      66 B/op	       0 allocs/op
BenchmarkNewEventedStore/Delete_1000000/1024-4 	10000000	       174 ns/op	       0 B/op	       0 allocs/op
BenchmarkNewEventedStore/Reset_1000000/1024-4  	 5000000	       238 ns/op	      48 B/op	       1 allocs/op
BenchmarkNewEventedStore/Iterate_1000000/1024-4  5000000	       268 ns/op	      32 B/op	       1 allocs/op
*/
func BenchmarkNewEventedStore(b *testing.B) {
	//b.SkipNow()

	i := 0
	op := func(key string, value []byte) {
		i++
	}
	test.Benchmark(b, func() raw.Store {
		store := raw.NewEventedStore(raw.NewDefaultStore())
		store.On(raw.EventBeforeGet, op)
		store.On(raw.EventBeforeSet, op)
		store.On(raw.EventBeforeDelete, op)
		store.On(raw.EventBeforeReset, op)
		store.On(raw.EventAfterGet, op)
		store.On(raw.EventAfterSet, op)
		store.On(raw.EventAfterDelete, op)
		store.On(raw.EventAfterReset, op)
		return store
	})
}

/*
--- PASS: TestNewEventedStore (46.08s)
    --- PASS: TestNewEventedStore/Get_1000/16 (0.00s)
        gc.go:13: Alloc         : 32000 (18446744073708972688)
        gc.go:14: TotalAlloc    : 32000 (3776)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000 (13)
        gc.go:17: Frees         : 0 (7233)
        gc.go:18: HeapAlloc     : 32000 (18446744073708972688)
        gc.go:19: HeapIdle      : 18446744073709535232 (704512)
        gc.go:20: HeapInuse     : 16384 (18446744073708814336)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000 (18446744073709544396)
        gc.go:23: PauseTotalNs  : 0 (9004)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (0.008555)
    --- PASS: TestNewEventedStore/Get_1000/1024 (0.01s)
        gc.go:13: Alloc         : 32000 (18446744073707964392)
        gc.go:14: TotalAlloc    : 32000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000 (0)
        gc.go:17: Frees         : 0 (7208)
        gc.go:18: HeapAlloc     : 32000 (18446744073707964392)
        gc.go:19: HeapIdle      : 18446744073709535232 (1548288)
        gc.go:20: HeapInuse     : 16384 (18446744073708003328)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000 (18446744073709544408)
        gc.go:23: PauseTotalNs  : 0 (18124)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.001150)
    --- PASS: TestNewEventedStore/Get_1000/262144 (0.80s)
        gc.go:13: Alloc         : 32000 (18446744073447383256)
        gc.go:14: TotalAlloc    : 32000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000 (0)
        gc.go:17: Frees         : 0 (3570)
        gc.go:18: HeapAlloc     : 32000 (18446744073447383256)
        gc.go:19: HeapIdle      : 18446744073709535232 (262127616)
        gc.go:20: HeapInuse     : 16384 (18446744073447391232)
        gc.go:21: HeapReleased  : 0 (18446744073709518848)
        gc.go:22: HeapObjects   : 1000 (18446744073709548046)
        gc.go:23: PauseTotalNs  : 0 (17702)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000035)
    --- PASS: TestNewEventedStore/Get_1000000/16 (5.14s)
        gc.go:13: Alloc         : 32000000 (18446744073410367768)
        gc.go:14: TotalAlloc    : 32000000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000000 (0)
        gc.go:17: Frees         : 0 (3593183)
        gc.go:18: HeapAlloc     : 32000000 (18446744073410367768)
        gc.go:19: HeapIdle      : 18446744073677570048 (307331072)
        gc.go:20: HeapInuse     : 31981568 (18446744073402220544)
        gc.go:21: HeapReleased  : 18446744073678045184 (18446744073709518848)
        gc.go:22: HeapObjects   : 1000000 (18446744073705958433)
        gc.go:23: PauseTotalNs  : 0 (25056)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.012589)
    --- PASS: TestNewEventedStore/Get_1000000/1024 (6.16s)
        gc.go:13: Alloc         : 32000000 (18446744072400349432)
        gc.go:14: TotalAlloc    : 32000000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000000 (0)
        gc.go:17: Frees         : 0 (3627280)
        gc.go:18: HeapAlloc     : 32000000 (18446744072400349432)
        gc.go:19: HeapIdle      : 18446744073677570048 (1310728192)
        gc.go:20: HeapInuse     : 31981568 (18446744072398823424)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000000 (18446744073705924336)
        gc.go:23: PauseTotalNs  : 0 (2540046)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.004241)
    --- PASS: TestNewEventedStore/Set_1000/16 (0.00s)
        gc.go:13: Alloc         : 199520 (18446744073708945576)
        gc.go:14: TotalAlloc    : 199520 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 21 (0)
        gc.go:17: Frees         : 0 (4228)
        gc.go:18: HeapAlloc     : 199520 (18446744073708945576)
        gc.go:19: HeapIdle      : 18446744073709371392 (589824)
        gc.go:20: HeapInuse     : 180224 (18446744073708961792)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 21 (18446744073709547388)
        gc.go:23: PauseTotalNs  : 0 (9243)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000460)
    --- PASS: TestNewEventedStore/Set_1000/1024 (0.00s)
        gc.go:13: Alloc         : 203392 (18446744073708799752)
        gc.go:14: TotalAlloc    : 203392 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 32 (0)
        gc.go:17: Frees         : 0 (6249)
        gc.go:18: HeapAlloc     : 203392 (18446744073708799752)
        gc.go:19: HeapIdle      : 18446744073709371392 (729088)
        gc.go:20: HeapInuse     : 180224 (18446744073708822528)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 32 (18446744073709545367)
        gc.go:23: PauseTotalNs  : 0 (24852)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000010)
    --- PASS: TestNewEventedStore/Set_1000/262144 (0.51s)
        gc.go:13: Alloc         : 200928 (18446744073708075032)
        gc.go:14: TotalAlloc    : 200928 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 25 (0)
        gc.go:17: Frees         : 0 (2560)
        gc.go:18: HeapAlloc     : 200928 (18446744073708075032)
        gc.go:19: HeapIdle      : 18446744073709338624 (1482752)
        gc.go:20: HeapInuse     : 212992 (18446744073708068864)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 25 (18446744073709549056)
        gc.go:23: PauseTotalNs  : 0 (58605)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000152)
    --- PASS: TestNewEventedStore/Set_1000000/16 (3.35s)
        gc.go:13: Alloc         : 18446744073554265064 (18446744073353696496)
        gc.go:14: TotalAlloc    : 200623680 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 38148 (0)
        gc.go:17: Frees         : 2343640 (21274)
        gc.go:18: HeapAlloc     : 18446744073554265064 (18446744073353696496)
        gc.go:19: HeapIdle      : 128983040 (355917824)
        gc.go:20: HeapInuse     : 18446744073580568576 (18446744073353633792)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 18446744073707246124 (18446744073709530342)
        gc.go:23: PauseTotalNs  : 17481 (64453)
        gc.go:24: NumGC         : 1 (1)
        gc.go:25: GCCPUFraction : -0.000141 (0.000801)
    --- PASS: TestNewEventedStore/Set_1000000/1024 (6.90s)
        gc.go:13: Alloc         : 18446744073607675240 (18446744073474329424)
        gc.go:14: TotalAlloc    : 200738544 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 38475 (0)
        gc.go:17: Frees         : 1858775 (2019433)
        gc.go:18: HeapAlloc     : 18446744073607675240 (18446744073474329424)
        gc.go:19: HeapIdle      : 349437952 (262799360)
        gc.go:20: HeapInuse     : 18446744073628549120 (18446744073446752256)
        gc.go:21: HeapReleased  : 116301824 (18446744073709486080)
        gc.go:22: HeapObjects   : 18446744073707731316 (18446744073707532183)
        gc.go:23: PauseTotalNs  : 21849 (22641)
        gc.go:24: NumGC         : 1 (1)
        gc.go:25: GCCPUFraction : -0.001726 (0.001131)
    --- PASS: TestNewEventedStore/Delete_1000/16 (0.17s)
        gc.go:13: Alloc         : 0 (18446744072559512632)
        gc.go:14: TotalAlloc    : 0 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 0 (0)
        gc.go:17: Frees         : 0 (2006216)
        gc.go:18: HeapAlloc     : 0 (18446744072559512632)
        gc.go:19: HeapIdle      : 0 (1150042112)
        gc.go:20: HeapInuse     : 0 (18446744072559509504)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 0 (18446744073707545400)
        gc.go:23: PauseTotalNs  : 0 (6144)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000078)
    --- PASS: TestNewEventedStore/Delete_1000/1024 (0.01s)
        gc.go:13: Alloc         : 0 (18446744073707991544)
        gc.go:14: TotalAlloc    : 0 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 0 (0)
        gc.go:17: Frees         : 0 (6212)
        gc.go:18: HeapAlloc     : 0 (18446744073707991544)
        gc.go:19: HeapIdle      : 0 (1572864)
        gc.go:20: HeapInuse     : 0 (18446744073707978752)
        gc.go:21: HeapReleased  : 0 (18446744073709518848)
        gc.go:22: HeapObjects   : 0 (18446744073709545404)
        gc.go:23: PauseTotalNs  : 0 (25429)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000272)
    --- PASS: TestNewEventedStore/Delete_1000/262144 (0.68s)
        gc.go:13: Alloc         : 0 (18446744073447149928)
        gc.go:14: TotalAlloc    : 0 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 0 (0)
        gc.go:17: Frees         : 0 (2618)
        gc.go:18: HeapAlloc     : 0 (18446744073447149928)
        gc.go:19: HeapIdle      : 0 (262397952)
        gc.go:20: HeapInuse     : 0 (18446744073447153664)
        gc.go:21: HeapReleased  : 0 (18446744073709518848)
        gc.go:22: HeapObjects   : 0 (18446744073709548998)
        gc.go:23: PauseTotalNs  : 0 (40223)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000129)
    --- PASS: TestNewEventedStore/Delete_1000000/16 (3.43s)
        gc.go:13: Alloc         : 18446744073671077952 (18446744073561089528)
        gc.go:14: TotalAlloc    : 0 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 0 (0)
        gc.go:17: Frees         : 588019 (2239904)
        gc.go:18: HeapAlloc     : 18446744073671077952 (18446744073561089528)
        gc.go:19: HeapIdle      : 29474816 (165756928)
        gc.go:20: HeapInuse     : 18446744073680109568 (18446744073543794688)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 18446744073708963597 (18446744073707311712)
        gc.go:23: PauseTotalNs  : 0 (33278)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000257)
    --- PASS: TestNewEventedStore/Delete_1000000/1024 (5.51s)
        gc.go:13: Alloc         : 0 (18446744072408553272)
        gc.go:14: TotalAlloc    : 0 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 0 (0)
        gc.go:17: Frees         : 0 (3052504)
        gc.go:18: HeapAlloc     : 0 (18446744072408553272)
        gc.go:19: HeapIdle      : 0 (1301594112)
        gc.go:20: HeapInuse     : 0 (18446744072407957504)
        gc.go:21: HeapReleased  : 0 (18446744073709486080)
        gc.go:22: HeapObjects   : 0 (18446744073706499112)
        gc.go:23: PauseTotalNs  : 0 (18332)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.001481)
    --- PASS: TestNewEventedStore/Reset_1000/16 (0.00s)
        gc.go:13: Alloc         : 48032 (18446744073615884520)
        gc.go:14: TotalAlloc    : 48032 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1001 (0)
        gc.go:17: Frees         : 0 (1176)
        gc.go:18: HeapAlloc     : 48032 (18446744073615884520)
        gc.go:19: HeapIdle      : 18446744073709502464 (93618176)
        gc.go:20: HeapInuse     : 49152 (18446744073615933440)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1001 (18446744073709550440)
        gc.go:23: PauseTotalNs  : 0 (43193)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000196)
    --- PASS: TestNewEventedStore/Reset_1000/1024 (0.00s)
        gc.go:13: Alloc         : 48032 (18446744073708942216)
        gc.go:14: TotalAlloc    : 48032 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1001 (0)
        gc.go:17: Frees         : 0 (14163)
        gc.go:18: HeapAlloc     : 48032 (18446744073708942216)
        gc.go:19: HeapIdle      : 18446744073709502464 (475136)
        gc.go:20: HeapInuse     : 49152 (18446744073709076480)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1001 (18446744073709537453)
        gc.go:23: PauseTotalNs  : 0 (35476)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (0.000003)
    --- PASS: TestNewEventedStore/Reset_1000/262144 (0.00s)
        gc.go:13: Alloc         : 48032 (18446744073708942152)
        gc.go:14: TotalAlloc    : 48032 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1001 (0)
        gc.go:17: Frees         : 0 (14164)
        gc.go:18: HeapAlloc     : 48032 (18446744073708942152)
        gc.go:19: HeapIdle      : 18446744073709510656 (466944)
        gc.go:20: HeapInuse     : 40960 (18446744073709084672)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1001 (18446744073709537452)
        gc.go:23: PauseTotalNs  : 0 (24187)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (0.000002)
    --- PASS: TestNewEventedStore/Reset_1000000/16 (2.06s)
        gc.go:13: Alloc         : 48000032 (18446744073661023120)
        gc.go:14: TotalAlloc    : 48000032 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000001 (0)
        gc.go:17: Frees         : 0 (1013004)
        gc.go:18: HeapAlloc     : 48000032 (18446744073661023120)
        gc.go:19: HeapIdle      : 18446744073661685760 (393216)
        gc.go:20: HeapInuse     : 48193536 (18446744073709158400)
        gc.go:21: HeapReleased  : 18446744073661685760 (18446744073709256704)
        gc.go:22: HeapObjects   : 1000001 (18446744073708538612)
        gc.go:23: PauseTotalNs  : 0 (23457)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (0.001824)
    --- PASS: TestNewEventedStore/Reset_1000000/1024 (2.26s)
        gc.go:13: Alloc         : 48000032 (18446744073133544320)
        gc.go:14: TotalAlloc    : 48000032 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000001 (0)
        gc.go:17: Frees         : 0 (14000005)
        gc.go:18: HeapAlloc     : 48000032 (18446744073133544320)
        gc.go:19: HeapIdle      : 18446744073661784064 (484704256)
        gc.go:20: HeapInuse     : 48193536 (18446744073224847360)
        gc.go:21: HeapReleased  : 18446744073661784064 (18446744073709223936)
        gc.go:22: HeapObjects   : 1000001 (18446744073695551611)
        gc.go:23: PauseTotalNs  : 0 (8015)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (0.001981)
    --- PASS: TestNewEventedStore/Iterate_1000/16 (0.11s)
        gc.go:13: Alloc         : 32000 (18446744073180960776)
        gc.go:14: TotalAlloc    : 32000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000 (0)
        gc.go:17: Frees         : 0 (13007215)
        gc.go:18: HeapAlloc     : 32000 (18446744073180960776)
        gc.go:19: HeapIdle      : 18446744073709543424 (629882880)
        gc.go:20: HeapInuse     : 8192 (18446744073079668736)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000 (18446744073696544401)
        gc.go:23: PauseTotalNs  : 0 (25123)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000151)
    --- PASS: TestNewEventedStore/Iterate_1000/1024 (0.00s)
        gc.go:13: Alloc         : 32000 (18446744073707962184)
        gc.go:14: TotalAlloc    : 32000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000 (0)
        gc.go:17: Frees         : 0 (7212)
        gc.go:18: HeapAlloc     : 32000 (18446744073707962184)
        gc.go:19: HeapIdle      : 18446744073709535232 (1581056)
        gc.go:20: HeapInuse     : 16384 (18446744073707970560)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000 (18446744073709544404)
        gc.go:23: PauseTotalNs  : 0 (15649)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000141)
    --- PASS: TestNewEventedStore/Iterate_1000/262144 (0.47s)
        gc.go:13: Alloc         : 32000 (18446744073447370376)
        gc.go:14: TotalAlloc    : 32000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000 (0)
        gc.go:17: Frees         : 0 (3747)
        gc.go:18: HeapAlloc     : 32000 (18446744073447370376)
        gc.go:19: HeapIdle      : 18446744073709535232 (262160384)
        gc.go:20: HeapInuse     : 16384 (18446744073447391232)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000 (18446744073709547869)
        gc.go:23: PauseTotalNs  : 0 (40899)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000104)
    --- PASS: TestNewEventedStore/Iterate_1000000/16 (3.24s)
        gc.go:13: Alloc         : 32000000 (18446744073426519352)
        gc.go:14: TotalAlloc    : 32000000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000000 (0)
        gc.go:17: Frees         : 0 (3369587)
        gc.go:18: HeapAlloc     : 32000000 (18446744073426519352)
        gc.go:19: HeapIdle      : 18446744073677570048 (299753472)
        gc.go:20: HeapInuse     : 31981568 (18446744073409798144)
        gc.go:21: HeapReleased  : 0 (0)
        gc.go:22: HeapObjects   : 1000000 (18446744073706182029)
        gc.go:23: PauseTotalNs  : 0 (9033)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.000443)
    --- PASS: TestNewEventedStore/Iterate_1000000/1024 (5.23s)
        gc.go:13: Alloc         : 32000000 (18446744072399065192)
        gc.go:14: TotalAlloc    : 32000000 (0)
        gc.go:15: Lookups       : 0 (0)
        gc.go:16: Mallocs       : 1000000 (0)
        gc.go:17: Frees         : 0 (3649774)
        gc.go:18: HeapAlloc     : 32000000 (18446744072399065192)
        gc.go:19: HeapIdle      : 18446744073677570048 (1312071680)
        gc.go:20: HeapInuse     : 31981568 (18446744072397479936)
        gc.go:21: HeapReleased  : 18446744073677570048 (18446744073709518848)
        gc.go:22: HeapObjects   : 1000000 (18446744073705901842)
        gc.go:23: PauseTotalNs  : 0 (47824)
        gc.go:24: NumGC         : 0 (1)
        gc.go:25: GCCPUFraction : 0.000000 (-0.001039)
*/
func TestNewEventedStore(t *testing.T) {
	i := 0
	op := func(key string, value []byte) {
		i++
	}
	test.GCStress(t, func() raw.Store {
		store := raw.NewEventedStore(raw.NewDefaultStore())
		store.On(raw.EventBeforeGet, op)
		store.On(raw.EventBeforeSet, op)
		store.On(raw.EventBeforeDelete, op)
		store.On(raw.EventBeforeReset, op)
		store.On(raw.EventAfterGet, op)
		store.On(raw.EventAfterSet, op)
		store.On(raw.EventAfterDelete, op)
		store.On(raw.EventAfterReset, op)
		return store
	})
}
